# Enable starship prompt
eval "$(starship init zsh)"

# Aliases
if [ -f "${HOME}/.bash_aliases" ]; then
  source "${HOME}/.bash_aliases"
fi

# Scripts
if [ -f "${HOME}/scripts/functions.sh" ]; then
  source "${HOME}/scripts/functions.sh"
fi

# Syntax highlighting
# source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# Autosuggestions
source /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=240'
bindkey '^[[C' autosuggest-accept

# Vi mode
ZVM_CURSOR_STYLE_ENABLED=false
source /usr/share/zsh/plugins/zsh-vi-mode/zsh-vi-mode.zsh
bindkey -M viins '\e[H' beginning-of-line
bindkey -M viins '\e[F' end-of-line
bindkey -M viins '\e[1~' beginning-of-line
bindkey -M viins '\e[4~' end-of-line

# Enable substitution in the prompt
setopt prompt_subst

# Auto cd
setopt AUTO_CD

# Autocompletion
autoload -Uz compinit && compinit
zstyle ':completion:*' menu select

# fzf tab completion
source /usr/share/zsh/plugins/fzf-tab-git/fzf-tab.zsh
zstyle ':fzf-tab:*' disabled-on files

setopt AUTO_PARAM_SLASH
setopt NO_MENU_COMPLETE

# History
export HISTFILE=${ZDOTDIR:-$HOME}/.zsh_history
export HISTSIZE=1000000
export SAVEHIST=$HISTSIZE
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_SAVE_NO_DUPS
setopt EXTENDED_HISTORY
setopt SHARE_HISTORY
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
setopt HIST_VERIFY
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS

# Text editing
export EDITOR=nvim
export VISUAL=nvim

# Python
export PYTHONDONTWRITEBYTECODE=1

# fzf
function zvm_after_init() {
  source /usr/share/fzf/completion.zsh
  source /usr/share/fzf/key-bindings.zsh
}

export FZF_DEFAULT_COMMAND="fd --hidden --exclude .git --exclude node_modules"
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_CTRL_T_OPTS="--height=40% --preview='cat {}' --preview-window=right:60%:wrap"
export FZF_DEFAULT_OPTS="--height=40% --layout=reverse --border"
export FZF_CTRL_R_OPTS="--preview 'echo {}' --preview-window down:3:hidden:wrap"

# Make Ctrl+L clear screen properly
bindkey '^L' clear-screen

# Starship
export STARSHIP_CONFIG=~/.config/starship/starship.toml
